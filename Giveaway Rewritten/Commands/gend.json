{
  "name": "gend",
  "permissions": "NONE",
  "restriction": "1",
  "_id": "gIEuf",
  "actions": [
    {
      "behavior": "0",
      "interpretation": "1",
      "code": "const fs = require('fs');\nconst baseParam = msg.content.split(\" \");\nconst embedID = baseParam[1];\n\nmsg.delete();\n\nif (msg.member.hasPermission(['MANAGE_CHANNELS'])) {\n    if (!isNaN(embedID) && embedID != null) {\n        var giveawaySysData = Actions.giveawaySystem;\n\n\n        if (giveawaySysData.hasOwnProperty(msg.guild.id)) {\n            var guildGiveaways = giveawaySysData[msg.guild.id];\n            var giveaway = guildGiveaways.filter(object => object[\"id\"] == embedID);\n\n            if (giveaway.length != 0) {\n                let giveawaysDue = giveaway[0];\n                guildGiveaways.splice(guildGiveaways.findIndex(e => e.id == giveawaysDue.id), 1)\n\n                fs.writeFile(\"./data/giveawaySystem/giveawayData.json\", JSON.stringify(giveawaySysData), async function(err) {\n                    if (err) {\n                        return console.log(err);\n                    }\n                    var channelToFetch = await client.channels.cache.get(giveawaysDue[\"channel\"]);\n                    if (channelToFetch != null) {\n                        var giveawayMessage = await channelToFetch.messages.fetch(giveawaysDue[\"giveawayMessageID\"]);\n\n                        var giveawayEmojiCache = giveawayMessage.reactions.cache.get('ðŸŽ‰');\n                        var giveawayUsers = await giveawayEmojiCache.users.fetch();\n                        if (giveawayEmojiCache.count > 100) {\n                            for (i = 0; i < giveawayEmojiCache.count; i++) {\n                                var fetchedEmojiUsers = await giveawayEmojiCache.users.fetch({\n                                    after: giveawayUsers.last().id\n                                });\n                                await giveawayUsers.concat(fetchedEmojiUsers);\n                            }\n                        }\n\n                        giveawayUsers = giveawayUsers.array();\n                        giveawayUsers = await giveawayUsers.filter(object => object.id != client.user.id);\n                        var numberOfWinners = parseInt(giveawaysDue[\"winner\"]);\n                        var gw = giveawayMessage.embeds[0];\n\n                        gw.color = 0x000000;\n                        if (gw.fields.length == 6) {\n                            gw.fields[5].value = \"Ended\"\n                        }\n                        gw.description = \"**Giveaway Ended**\\n\\n\" + gw.description\n\n                        var winnerArray = [];\n                        if (giveawayUsers.length > 0) {\n                            if (giveawayUsers.length > numberOfWinners) {\n                                for (var i = 0; i < numberOfWinners; i++) {\n                                    var randomNumber = Math.floor(Math.random() * giveawayUsers.length);\n                                    winnerArray.push(`${giveawayUsers[randomNumber]}`);\n                                    giveawayUsers.splice(giveawayUsers.indexOf(randomNumber), randomNumber);\n                                }\n                            } else if (giveawayUsers.length <= numberOfWinners) {\n                                for (i = 0; i < giveawayUsers.length; i++) {\n                                    winnerArray.push(`${giveawayUsers[i]}`);\n                                }\n                            }\n                            var winnerText = \"\";\n                            for (i = 0; i < winnerArray.length; i++) {\n                                winnerText = winnerText + winnerArray[i] + '\\n';\n                            }\n\n                            gw.description += `\\n\\nThe winners are..\\n${winnerText}`;\n                            giveawayMessage.edit({\n                                embed: gw\n                            });\n                            channelToFetch.send(`ðŸŽ‰ Congratulations! ðŸŽ‰ \\n ${winnerText} \\nThey have won **${giveawaysDue[\"itemGivingAway\"]}**`);\n\n                        } else {\n                            gw.description += \"\\n\\nNo one entered the giveaway and thus no one won.\";\n                            giveawayMessage.edit({\n                                embed: gw\n                            });\n                            channelToFetch.send(`ðŸŽ‰ Giveaway Ended ðŸŽ‰\\n\\nNo one entered the giveaway and thus no one won.`);\n                        }\n                    }\n                });\n            } else {\n                errorMessage(\"Giveaway message not found.\\nMake sure it is an active giveaway and recheck the id!\");\n            }\n        } else {\n            errorMessage(\"This server does not have any on-going giveaways!\")\n        }\n\n    } else {\n        errorMessage(\"Please enter a valid giveaway id!\")\n    }\n} else {\n    errorMessage(\"You don't have the permission to execute the command!\");\n}\n\nfunction errorMessage(error) {\n    let errorTemplate = {\n        color: 0xFF0000,\n        author: {\n            name: client.user.username,\n            icon_url: client.user.avatarURL\n        },\n        title: \"Giveaway End\",\n        description: error,\n        timestamp: new Date(),\n    }\n\n    msg.channel.send({\n        embed: errorTemplate\n    });\n}\n\n// VersionCheck:2",
      "storage": "0",
      "varName": "",
      "name": "Run Script"
    }
  ]
}