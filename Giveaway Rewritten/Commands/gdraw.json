{
  "name": "gdraw",
  "permissions": "NONE",
  "restriction": "1",
  "_id": "mXltB",
  "actions": [
    {
      "message": "0",
      "varName": "",
      "info": "0",
      "ParamN": "1",
      "separator": "",
      "storage": "1",
      "varName2": "giveawayWinners",
      "count": "1",
      "name": "Store Message Params"
    },
    {
      "message": "0",
      "varName": "",
      "info": "0",
      "ParamN": "2",
      "separator": "",
      "storage": "1",
      "varName2": "giveawayID",
      "count": "1",
      "name": "Store Message Params"
    },
    {
      "behavior": "0",
      "interpretation": "1",
      "code": "const giveawayWinners = tempVars(\"giveawayWinners\");\nconst giveawayID = tempVars(\"giveawayID\");\n\nmsg.delete()\n\nasync function drawWinner() {\n    if (!isNaN(giveawayWinners) && giveawayWinners > 0 && giveawayWinners != null || giveawayID != null && giveawayWinners != null) {\n        var serverMessages = await msg.channel.messages.fetch({\n            limit: 100\n        });\n        \n        var messagesList = [];\n        var winnerArray = [];\n        var winnerText = \"\";\n        var supposeGiveawayMSG;\n\n        if (giveawayID == null) {\n            serverMessages = serverMessages.array();\n            serverMessages = serverMessages.filter(object => object.author.id == client.user.id);\n\n            for (i = 0; i < serverMessages.length; i++) {\n                let tempserverMsg = serverMessages[i];\n                let tempserverEmbed = serverMessages[i][\"embeds\"][0];\n                if (tempserverEmbed != null && tempserverMsg.reactions.cache.get('ðŸŽ‰') != null && tempserverEmbed.fields.length == 6 && tempserverEmbed.color == 0x000000 && tempserverEmbed.fields[5].value == \"Ended\") {\n                    messagesList.push(serverMessages[i]);\n                }\n            }\n        } else {\n            supposeGiveawayMSG = await msg.channel.messages.fetch(giveawayID);\n            var supposegiveawayEmbed = supposeGiveawayMSG[\"embeds\"][0];\n            if (supposeGiveawayMSG != null && supposegiveawayEmbed != null && supposeGiveawayMSG.reactions.cache.get('ðŸŽ‰') != null && supposegiveawayEmbed.fields.length == 6 && supposegiveawayEmbed.color == 0x000000 && supposegiveawayEmbed.fields[5].value == \"Ended\") {\n                 messagesList.push(supposeGiveawayMSG);\n            } else {\n                errorMessage(\"Invalid giveaway!\\n\\nPlease re-check your message id!\\n\\nMake sure the giveaway has ended!\");\n            }\n        }\n\n        if (messagesList.length > 0) {\n            var giveawayMessage = messagesList[0];\n            var giveawayEmojiCache = giveawayMessage.reactions.cache.get('ðŸŽ‰');\n            var giveawayUsers = await giveawayEmojiCache.users.fetch();\n            if (giveawayEmojiCache.count > 100) {\n                for (i=0; i<giveawayEmojiCache.count; i++) {\n                    var fetchedEmojiUsers = await giveawayEmojiCache.users.fetch({after: giveawayUsers.last().id});\n                    await giveawayUsers.concat(fetchedEmojiUsers);\n                }\n            }\n            \n            giveawayUsers = await giveawayUsers.array();\n            giveawayUsers = await giveawayUsers.filter(object => object.id != client.user.id);\n\n            if (giveawayUsers.length > 0) {\n                if (giveawayUsers.length > giveawayWinners) {\n                    for (var i = 0; i < giveawayWinners; i++) {\n                        var randomNumber = Math.floor(Math.random() * giveawayUsers.length);\n                        winnerArray.push(`${giveawayUsers[randomNumber]}`);\n                        giveawayUsers.splice(giveawayUsers.indexOf(randomNumber), randomNumber);\n                    }\n                } else if (giveawayUsers.length <= giveawayWinners) {\n                    for (i = 0; i < giveawayUsers.length; i++) {\n                        winnerArray.push(`${giveawayUsers[i]}`);\n                    }\n                }\n\n                for (i = 0; i < winnerArray.length; i++) {\n                    winnerText = winnerText + winnerArray[i] + '\\n';\n                }\n\n                if (giveawayID != null) {\n                    msg.channel.send(\"ðŸŽ‰ Giveaway Redraw ðŸŽ‰\\n\\n Winners are:\\n\" + winnerText + \"\\n\" + \"Item: \" + giveawayMessage.embeds[0].fields[1].value);\n                } else {\n                    msg.channel.send(\"ðŸŽ‰ Giveaway Redraw ðŸŽ‰\\n\\n Winners are:\\n\" + winnerText + \"\\n\" + \"Item: \" + giveawayMessage.embeds[0].fields[1].value + \"\\nWinner drawn from message: \" + giveawayMessage.id);\n                }\n                \n\n            } else {\n                if (supposeGiveawayMSG == null) {\n                  errorMessage(\"No one reacted in the recent giveaway hosted, cannot draw a member!\");\n                } else  {\n                  errorMessage(\"No one reacted in the selected giveaway hosted, cannot draw a member!\");\n                }\n            }\n        } else if (supposeGiveawayMSG == null) {errorMessage(\"There is no recent giveaway hosted, cannot draw a member!\\n\\nMake sure the giveaway has ended!\");}\n    } else {errorMessage(\"Please enter a valid amount of players to be selected to win!\");}\n\n    function errorMessage(error) {\n        let errorTemplate = {\n            color: 0xFF0000,\n            author: {\n                name: client.user.username,\n                icon_url: client.user.avatarURL\n            },\n            title: \"Giveaway Draw\",\n            description: error,\n            timestamp: new Date(),\n        }\n\n        msg.channel.send({embed:errorTemplate});\n    }\n}\n\nif (msg.member.hasPermission(['MANAGE_CHANNELS'])) {\n    drawWinner();\n} else {\n    errorMessage(\"You don't have the permission to execute the command!\");\n}\n\n// VersionCheck:1",
      "storage": "0",
      "varName": "",
      "name": "Run Script"
    }
  ]
}